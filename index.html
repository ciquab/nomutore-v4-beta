<!DOCTYPE html>
<html lang="ja" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Nomutore - Craft & Flow</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#18181b">
    <link rel="apple-touch-icon" href="icon-192.png">

    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/dexie@3.2.4/dist/dexie.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'Noto Sans JP', 'sans-serif'],
                    },
                    colors: {
                        brand: { light: '#E0E7FF', DEFAULT: '#4F46E5', dark: '#3730A3' }, // Keep for legacy compatibility if needed
                        base: {
                            50: '#f9fafb',
                            100: '#f3f4f6',
                            200: '#e5e7eb',
                            800: '#18181b', 
                            900: '#0f0f13', 
                        },
                        accent: {
                            DEFAULT: '#f59e0b', // Amber
                            hover: '#d97706',
                            light: '#fbbf24',
                            glow: 'rgba(245, 158, 11, 0.5)',
                        },
                        recovery: {
                            DEFAULT: '#10b981', // Emerald
                            hover: '#059669',
                            glow: 'rgba(16, 185, 129, 0.4)',
                        },
                        text: {
                            dark: '#111827',
                            light: '#fafafa',
                            muted: '#9ca3af',
                            mutedDark: '#6b7280',
                        }
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'wave-rotate': 'wave-rotate 8s linear infinite',
                        'wave-rotate-reverse': 'wave-rotate 11s linear infinite reverse',
                        'bounce-horizontal': 'swipe 1.5s infinite ease-in-out',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        'wave-rotate': {
                            '0%': { transform: 'rotate(0deg)' },
                            '100%': { transform: 'rotate(360deg)' },
                        },
                        swipe: {
                            '0%, 100%': { transform: 'translateX(-20%)' },
                            '50%': { transform: 'translateX(20%)' }
                        }
                    }
                }
            }
        }
    </script>
    
    <script>
        (function() {
            try {
                const savedTheme = localStorage.getItem('hazy_payback_theme') || 'system';
                const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                if (savedTheme === 'dark' || (savedTheme === 'system' && systemDark)) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            } catch (e) {}
        })();
    </script>

    <style>
        /* Custom Styles for Glassmorphism & Details */
        body {
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }
        
        /* Glass Panel */
        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(0, 0, 0, 0.05);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .dark .glass-panel {
            background: rgba(24, 24, 27, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        /* Glass Nav */
        .glass-nav {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid rgba(0, 0, 0, 0.05);
        }
        .dark .glass-nav {
            background: rgba(24, 24, 27, 0.85);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Fluid Sphere Animation */
        .fluid-sphere {
            position: relative;
            width: 260px;
            height: 260px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .fluid-bg {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 30% 30%, #e5e7eb, #d1d5db);
            z-index: 1;
            box-shadow: 
                inset -10px -10px 20px rgba(0,0,0,0.05),
                inset 10px 10px 20px rgba(255,255,255,0.8),
                0 20px 50px rgba(0,0,0,0.1);
        }
        .dark .fluid-bg {
            background: radial-gradient(circle at 30% 30%, #27272a, #000);
            box-shadow: 
                inset -10px -10px 20px rgba(255,255,255,0.05),
                inset 10px 10px 20px rgba(0,0,0,0.5),
                0 20px 50px rgba(0,0,0,0.5);
        }

        /* Liquid Container - JS controls height of this */
        #tank-liquid {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            /* Height is set by JS */
            z-index: 2;
            transition: height 1s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden; /* Contains the waves */
        }
        
        /* The Wave Surface */
        .wave-surface-wrapper {
            position: absolute;
            top: -50%; /* Position relative to the rising liquid level */
            left: -50%;
            width: 200%;
            height: 200%; 
            border-radius: 40% 45% 42% 47%;
            z-index: 3;
        }
        
        .fluid-liquid-front {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.95), rgba(217, 119, 6, 0.9));
            animation: wave-rotate 8s linear infinite; 
        }

        .fluid-liquid-back {
            background: rgba(245, 158, 11, 0.6);
            border-radius: 43% 40% 46% 41%;
            animation: wave-rotate-reverse 11s linear infinite; 
            z-index: 2;
            top: -52%; /* Slight offset */
        }

        .status-ring {
            position: absolute;
            inset: -15px;
            border-radius: 50%;
            border: 2px solid rgba(0,0,0,0.05); 
            z-index: 0;
        }
        .dark .status-ring {
            border: 2px solid rgba(255,255,255,0.05);
        }

        /* Scrollbar hiding */
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #525252; border-radius: 4px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* Utility */
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body class="min-h-screen text-gray-800 dark:text-gray-100 bg-base-50 dark:bg-base-900 select-none overscroll-none transition-colors duration-300 font-sans pb-24">

    <div id="global-error-overlay" class="fixed inset-0 z-[100] bg-black/90 hidden flex flex-col items-center justify-center p-6 text-white text-center backdrop-blur-md">
        <div class="text-6xl mb-4">üòµ</div>
        <h2 class="text-2xl font-black mb-2">Oops! Error</h2>
        <p class="text-sm text-gray-400 mb-6">‰∫àÊúü„Åõ„Å¨„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ</p>
        <div class="w-full max-w-md bg-black/50 p-4 rounded-xl border border-white/10 mb-6 text-left overflow-auto max-h-48">
            <code id="error-details" class="text-xs font-mono text-red-400 break-all select-all"></code>
        </div>
        <div class="flex gap-4 w-full max-w-md">
            <button id="btn-copy-error" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 rounded-xl transition">Log Copy</button>
            <button onclick="location.reload()" class="flex-1 bg-accent hover:bg-accent-hover text-black font-bold py-3 rounded-xl transition shadow-lg shadow-accent/20">Reload</button>
        </div>
        <button onclick="document.getElementById('global-error-overlay').classList.add('hidden')" class="mt-8 text-xs text-gray-500 hover:text-white underline">Èñâ„Åò„Å¶Êìç‰Ωú„ÇíÁ∂ö„Åë„Çã (ÈùûÊé®Â•®)</button>
    </div>

    <header class="fixed top-0 w-full z-50 px-6 py-4 flex justify-between items-center glass-nav border-b-0 bg-opacity-0 transition-colors duration-300">
        <div class="container mx-auto max-w-xl flex justify-between items-center relative">
            
            <div class="flex flex-col">
                <span class="text-[10px] font-bold text-accent tracking-widest uppercase">„Éé„É†„Éà„É¨</span>
                <div class="flex items-center gap-2">
                    <h1 class="text-lg font-black text-gray-800 dark:text-white tracking-tighter">
                        NOMU<span class="text-accent">TORE</span>
                    </h1>
                </div>
            </div>

            <div class="flex gap-4">
                <button id="btn-open-help" class="text-text-mutedDark dark:text-text-muted hover:text-black dark:hover:text-white transition">
                   <i class="ph ph-question text-2xl"></i>
                </button>
                <button id="btn-open-settings" class="text-text-mutedDark dark:text-text-muted hover:text-black dark:hover:text-white transition">
                   <i class="ph ph-gear text-2xl"></i>
                </button>
            </div>
        </div>
    </header>

    <div id="swipe-area" class="min-h-[calc(100vh-12rem)] touch-pan-y pt-24">
        <div class="container mx-auto p-4 max-w-xl relative">
            
            <div id="message-box" class="fixed top-24 left-1/2 transform -translate-x-1/2 p-3 text-white rounded-xl shadow-lg hidden z-[100] text-center font-bold text-sm w-11/12 max-w-sm transition-all backdrop-blur-md bg-accent/90"></div>

            <div id="tab-home" class="tab-content active fade-in">
                
                <div class="flex justify-center mb-8 opacity-0 transition-opacity duration-500" id="mode-selector">
                    <div class="glass-panel py-1.5 px-4 rounded-full flex items-center gap-2">
                        <span class="text-[10px] font-bold text-text-mutedDark dark:text-text-muted uppercase tracking-wider">BASE</span>
                        <div class="relative group">
                            <select id="home-mode-select" class="appearance-none bg-transparent font-bold text-xs text-accent focus:outline-none pr-4 text-right cursor-pointer"></select>
                            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center text-accent">
                                <span class="text-[10px]">‚ñº</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="relative mb-10">
                    <div class="fluid-sphere animate-float">
                        <div class="absolute inset-0 rounded-full overflow-hidden z-10 isolate">
                            <div class="fluid-bg"></div>
                            
                            <div id="tank-liquid" style="height: 0%;">
                                <div class="wave-surface-wrapper fluid-liquid-back"></div>
                                <div class="wave-surface-wrapper fluid-liquid-front"></div>
                            </div>

                            <div id="tank-empty-icon" class="absolute inset-0 flex items-center justify-center text-4xl opacity-0 transition-opacity duration-500 z-20">üíî</div>
                        </div>
                        
                        <div class="status-ring"></div>
                        
                        <div class="absolute inset-0 flex flex-col items-center justify-center z-30 text-center pointer-events-none drop-shadow-md">
                            <span class="text-[10px] font-bold text-gray-500 dark:text-white/60 tracking-widest mb-1">DEBT (CANS)</span>
                            <div class="flex items-baseline gap-1">
                                <span id="tank-cans" class="text-5xl font-black text-gray-800 dark:text-white tracking-tighter">0.0</span>
                                <span class="text-sm font-bold text-gray-500 dark:text-white/60">Êú¨</span>
                            </div>
                            
                            <div class="mt-2 px-3 py-1 rounded-full bg-white/60 dark:bg-black/40 backdrop-blur-sm border border-black/5 dark:border-white/10 flex items-center gap-1.5">
                                <span class="text-[10px] font-bold text-text-mutedDark dark:text-text-muted">PAYBACK:</span>
                                <span id="tank-minutes" class="text-xs font-bold text-accent">+0 min</span>
                            </div>
                        </div>
                    </div>

                    <div class="absolute -bottom-4 left-1/2 transform -translate-x-1/2 z-40">
                         <button id="btn-share-sns" class="bg-base-800 dark:bg-white dark:text-black text-white text-xs font-bold px-4 py-2 rounded-full flex items-center gap-1.5 shadow-lg active:scale-95 transition hover:scale-105">
                            <i class="ph-bold ph-share-network"></i> „Ç∑„Çß„Ç¢
                        </button>
                    </div>
                </div>
                
                <div id="tank-message" class="text-center p-3 mb-6 mx-4">
                    <p class="text-sm font-bold text-text-mutedDark dark:text-text-muted">„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø‰∏≠...</p>
                </div>
                
                <div class="grid grid-cols-2 gap-3 mb-6">
                    <div id="liver-rank-card" class="glass-panel rounded-2xl p-4 relative overflow-hidden group hidden transition-all cursor-pointer hover:border-purple-500/50">
                        <div class="absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition">
                            <i class="ph-fill ph-trophy text-4xl text-purple-400"></i>
                        </div>
                        <p class="text-[10px] font-bold text-text-mutedDark dark:text-text-muted mb-1 uppercase">LIVER RANK</p>
                        <div class="flex items-end gap-2 mb-2 relative z-10">
                            <h3 class="text-xl font-black text-gray-800 dark:text-white" id="rank-title">Loading...</h3>
                            <span class="text-xs font-bold text-purple-500" id="dry-count">0<span class="text-[10px] text-text-muted ml-0.5">days</span></span>
                        </div>
                        <div class="w-full bg-base-200 dark:bg-base-700/50 rounded-full h-1.5 mb-2 overflow-hidden">
                            <div id="rank-progress" class="bg-purple-500 h-full rounded-full transition-all duration-1000" style="width: 0%"></div>
                        </div>
                        <p class="text-[10px] text-text-mutedDark dark:text-text-muted text-right" id="rank-next-msg">Next rank soon...</p>
                    </div>

                    <div class="glass-panel rounded-2xl p-4 relative overflow-hidden group">
                        <div class="absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition">
                            <i class="ph-fill ph-fire text-4xl text-orange-500"></i>
                        </div>
                        <p class="text-[10px] font-bold text-text-mutedDark dark:text-text-muted mb-1 uppercase">STREAK</p>
                        <div class="flex items-end gap-2 mb-2">
                            <span id="streak-count" class="text-3xl font-black text-accent">0</span>
                            <span class="text-xs text-text-mutedDark dark:text-white/60 mb-1">Days</span>
                        </div>
                        <div id="streak-badge" class="inline-flex items-center gap-1 px-1.5 py-0.5 rounded bg-accent/10 border border-accent/30">
                            <i class="ph-bold ph-trend-up text-[10px] text-accent"></i>
                            <span class="text-[10px] font-bold text-accent">Bonus Active</span>
                        </div>
                    </div>
                </div>

                <div class="glass-panel rounded-2xl p-4 mb-8">
                    <div class="flex justify-between items-end mb-3">
                        <p class="text-[10px] font-bold text-text-mutedDark dark:text-text-muted uppercase tracking-widest">LAST 7 DAYS</p>
                        <span id="weekly-status-text" class="text-[10px] font-bold text-recovery">Keep it up!</span>
                    </div>
                    <div id="weekly-stamps" class="flex justify-between items-center px-1">
                        </div>
                </div>

                <div id="check-status" class="hidden"></div>
            </div>

            <div id="tab-record" class="tab-content hidden fade-in">
                <div class="flex items-center gap-2 mb-4 px-2">
                     <i class="ph-fill ph-sneaker-move text-recovery text-xl"></i>
                     <h2 class="text-xl font-bold text-gray-800 dark:text-white">Workout & Recovery</h2>
                </div>

                <div class="glass-panel p-6 rounded-3xl mb-6 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-1 h-full bg-recovery"></div>
                    <div class="mb-4">
                        <label class="text-[10px] font-bold text-text-mutedDark dark:text-text-muted uppercase tracking-widest mb-2 block">MENU</label>
                        <select id="exercise-select" class="w-full p-3 bg-base-50 dark:bg-base-800/50 border border-base-200 dark:border-white/10 rounded-xl text-gray-800 dark:text-white font-bold focus:ring-2 focus:ring-recovery outline-none text-sm"></select>
                    </div>
                    
                    <div class="text-center py-4">
                        <div id="timer-display" class="text-7xl font-sans font-bold text-gray-800 dark:text-white tracking-tighter tabular-nums">00:00</div>
                        <p id="timer-status" class="text-xs text-text-muted font-bold mt-2 tracking-widest">READY TO START</p>
                    </div>

                    <div class="flex gap-3 mt-4">
                        <button id="start-stepper-btn" class="flex-1 bg-recovery hover:bg-recovery-hover text-white font-bold py-4 rounded-xl shadow-lg shadow-recovery/20 transition transform active:scale-95 text-lg flex justify-center items-center gap-2">
                            <i class="ph-bold ph-play"></i> START
                        </button>
                        <button id="manual-record-btn" class="flex-1 bg-transparent border-2 border-base-200 dark:border-white/10 text-text-mutedDark dark:text-text-muted hover:text-white hover:border-white/30 font-bold py-4 rounded-xl transition transform active:scale-95 text-sm">
                            ÊâãÂÖ•Âäõ
                        </button>
                        
                        <button id="pause-stepper-btn" class="hidden flex-1 bg-accent hover:bg-accent-hover text-black font-bold py-4 rounded-xl shadow-lg shadow-accent/20 transition transform active:scale-95 text-lg">PAUSE</button>
                        <button id="resume-stepper-btn" class="hidden flex-1 bg-recovery hover:bg-recovery-hover text-white font-bold py-4 rounded-xl shadow-lg shadow-recovery/20 transition transform active:scale-95 text-lg">RESUME</button>
                        <button id="stop-stepper-btn" class="hidden flex-1 bg-red-500 hover:bg-red-600 text-white font-bold py-4 rounded-xl shadow-lg shadow-red-500/20 transition transform active:scale-95 text-lg animate-pulse">STOP</button>
                    </div>
                </div>

                <div id="quick-input-area" class="flex gap-2 mb-2 px-1"></div>

                <div class="grid grid-cols-1 gap-4">
                    <button id="btn-open-beer" class="glass-panel p-4 rounded-2xl flex items-center gap-4 group hover:bg-accent/10 transition border-l-4 border-transparent hover:border-accent">
                        <div class="w-12 h-12 rounded-full bg-accent/20 text-accent flex items-center justify-center text-2xl group-hover:scale-110 transition">üç∫</div>
                        <div class="text-left flex-1">
                            <h3 class="font-bold text-gray-800 dark:text-white text-lg group-hover:text-accent transition">Record Drink</h3>
                            <p class="text-xs text-text-muted">È£≤ÈÖí„ÇíË®òÈå≤ (ÂÄüÈáëËøΩÂä†)</p>
                        </div>
                        <i class="ph-bold ph-caret-right text-text-muted"></i>
                    </button>

                    <button id="btn-open-check" class="glass-panel p-4 rounded-2xl flex items-center gap-4 group hover:bg-purple-500/10 transition border-l-4 border-transparent hover:border-purple-500">
                        <div class="w-12 h-12 rounded-full bg-purple-500/20 text-purple-400 flex items-center justify-center text-2xl group-hover:scale-110 transition">‚úÖ</div>
                        <div class="text-left flex-1">
                            <h3 class="font-bold text-gray-800 dark:text-white text-lg group-hover:text-purple-400 transition">Daily Check</h3>
                            <p class="text-xs text-text-muted">„Ç≥„É≥„Éá„Ç£„Ç∑„Éß„É≥Á¢∫Ë™ç</p>
                        </div>
                        <i class="ph-bold ph-caret-right text-text-muted"></i>
                    </button>
                </div>
            </div>

            <div id="tab-history" class="tab-content hidden fade-in">
                 <div class="flex items-center gap-2 mb-4 px-2">
                     <i class="ph-fill ph-chart-bar text-accent text-xl"></i>
                     <h2 class="text-xl font-bold text-gray-800 dark:text-white">Activity Log</h2>
                </div>
                
                <div id="heatmap-wrapper" class="glass-panel mb-6 rounded-2xl p-4">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-[10px] font-bold text-text-mutedDark dark:text-text-muted uppercase tracking-wider">Continuity</h3>
                        <div class="flex items-center gap-2">
                            <button id="heatmap-prev" class="p-1 hover:bg-base-200 dark:hover:bg-base-700 rounded text-text-muted active:scale-95 transition"><i class="ph-bold ph-caret-left"></i></button>
                            <span id="heatmap-period-label" class="text-xs font-bold text-text-muted">Last 5 Weeks</span>
                            <button id="heatmap-next" class="p-1 hover:bg-base-200 dark:hover:bg-base-700 rounded text-text-muted active:scale-95 transition disabled:opacity-30" disabled><i class="ph-bold ph-caret-right"></i></button>
                        </div>
                    </div>
                    <div id="heatmap-grid" class="grid grid-cols-7 gap-1.5 mb-3">
                         <div class="text-[10px] text-center text-text-muted">Sun</div>
                        <div class="text-[10px] text-center text-text-muted">Mon</div>
                        <div class="text-[10px] text-center text-text-muted">Tue</div>
                        <div class="text-[10px] text-center text-text-muted">Wed</div>
                        <div class="text-[10px] text-center text-text-muted">Thu</div>
                        <div class="text-[10px] text-center text-text-muted">Fri</div>
                        <div class="text-[10px] text-center text-text-muted">Sat</div>
                    </div>
                    <div class="flex flex-wrap justify-center gap-3 text-[10px] text-text-muted">
                        <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-recovery"></span>Dry+Run</div>
                        <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-green-400"></span>Dry</div>
                        <div class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-accent"></span>Drink</div>
                    </div>
                </div>

                <div id="chart-container" class="glass-panel p-5 rounded-3xl mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-[10px] font-bold text-text-mutedDark dark:text-text-muted uppercase tracking-wide flex items-center gap-2">
                            <span class="w-2 h-2 bg-accent rounded-full animate-pulse"></span> Balance Flow
                        </h2>
                        <div class="flex gap-1 bg-base-100 dark:bg-base-800 p-1 rounded-lg" id="chart-filters">
                            <button data-range="1w" class="px-2 py-1 text-[10px] font-bold rounded-md transition-all active-filter bg-white dark:bg-base-700 text-accent shadow-sm">1W</button>
                            <button data-range="1m" class="px-2 py-1 text-[10px] font-bold rounded-md transition-all text-text-muted hover:text-white">1M</button>
                            <button data-range="all" class="px-2 py-1 text-[10px] font-bold rounded-md transition-all text-text-muted hover:text-white">ALL</button>
                        </div>
                    </div>
                    <div class="relative h-64 w-full"><canvas id="balanceChart"></canvas></div>
                </div>

                <div class="glass-panel p-6 rounded-3xl mb-8 relative group/history">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex-1 min-w-0 mr-2">
                             <h2 class="text-lg font-bold text-gray-800 dark:text-white flex items-center">
                                <i class="ph-bold ph-list-dashes mr-2"></i> Timeline
                             </h2>
                             <p id="history-base-label" class="text-xs text-text-muted font-normal mt-0.5 truncate"></p>
                        </div>
                        <div class="flex gap-2 flex-shrink-0">
                            <button id="btn-select-all" class="hidden text-xs font-bold text-text-muted bg-base-100 dark:bg-base-800 px-3 py-1.5 rounded-lg transition">All</button>
                            <button id="btn-toggle-edit-mode" class="text-xs font-bold text-accent bg-accent/10 px-3 py-1.5 rounded-lg transition hover:bg-accent/20">Edit</button>
                        </div>
                    </div>
                    
                    <div id="bulk-action-bar" class="hidden absolute bottom-4 left-0 w-full px-6 z-20">
                         <button id="btn-bulk-delete" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-3 rounded-xl shadow-lg transition transform active:scale-95 flex items-center justify-center gap-2">
                            <i class="ph-bold ph-trash"></i> Delete (<span id="bulk-selected-count">0</span>)
                         </button>
                    </div>

                    <div id="log-container" class="log-container max-h-80 overflow-y-auto pr-1 transition-all custom-scrollbar">
                        <div id="log-list" class="divide-y divide-base-200 dark:divide-white/5"></div>
                    </div>
                </div>

                <div class="p-6 rounded-3xl border border-dashed border-base-300 dark:border-white/10 text-center mb-8">
                    <p class="text-[10px] text-text-muted mb-4 font-bold tracking-widest">DATA MANAGEMENT</p>
                    <div class="flex flex-col gap-3">
                        <div class="flex justify-center space-x-3">
                            <button id="btn-export-logs" class="text-accent dark:text-accent bg-base-50 dark:bg-base-800 border border-base-200 dark:border-white/10 px-3 py-2 rounded-lg text-xs font-bold hover:bg-base-100 dark:hover:bg-base-700 flex items-center gap-1 transition w-full justify-center">CSV (Logs)</button>
                            <button id="btn-export-checks" class="text-accent dark:text-accent bg-base-50 dark:bg-base-800 border border-base-200 dark:border-white/10 px-3 py-2 rounded-lg text-xs font-bold hover:bg-base-100 dark:hover:bg-base-700 flex items-center gap-1 transition w-full justify-center">CSV (Health)</button>
                        </div>
                        <div class="flex justify-center space-x-4 pt-2 border-t border-base-200 dark:border-white/10 mt-2">
                            <button id="btn-copy-data" class="text-text-muted text-xs font-bold hover:text-white flex items-center gap-1 transition">Copy</button>
                            <button id="btn-download-json" class="text-text-muted text-xs font-bold hover:text-white flex items-center gap-1 transition">Download</button>
                            <label class="text-text-muted text-xs font-bold hover:text-white flex items-center gap-1 cursor-pointer transition">Restore<input type="file" accept=".json" class="hidden" id="btn-import-json"></label>
                        </div>
                        <div class="pt-4 border-t border-base-200 dark:border-white/10 mt-2">
                            <button id="btn-reset-all" class="text-red-500 text-xs font-bold hover:text-red-400 px-4 py-2 transition w-full">Delete All Data</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="fixed bottom-6 left-1/2 transform -translate-x-1/2 z-50 w-full max-w-sm px-4">
        <nav class="glass-nav rounded-2xl p-2 flex justify-between items-center shadow-2xl border border-white/20 dark:border-white/10">
            
            <button id="nav-tab-home" class="nav-item flex-1 flex flex-col items-center gap-1 py-2 rounded-xl transition text-accent">
                <i class="ph-fill ph-house text-2xl mb-0.5"></i>
                <span class="text-[10px] font-bold">Home</span>
            </button>

            <button id="nav-tab-record" class="nav-item flex-1 flex flex-col items-center gap-1 py-2 rounded-xl transition text-text-mutedDark dark:text-text-muted hover:text-black dark:hover:text-white">
                 <div class="relative">
                    <i class="ph-fill ph-plus-circle text-4xl -mt-4 text-gray-400 dark:text-gray-500 bg-white dark:bg-base-900 rounded-full border-4 border-transparent nav-icon-record transition"></i>
                 </div>
                 <span class="text-[10px] font-bold -mt-1">Record</span>
            </button>

            <button id="nav-tab-history" class="nav-item flex-1 flex flex-col items-center gap-1 py-2 rounded-xl transition text-text-mutedDark dark:text-text-muted hover:text-black dark:hover:text-white">
                <i class="ph-fill ph-books text-2xl mb-0.5"></i>
                <span class="text-[10px] font-bold">History</span>
            </button>
            
        </nav>
    </div>

    <div id="log-detail-modal" class="fixed inset-0 bg-black/80 hidden z-[70] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="glass-panel dark:bg-base-800 p-6 rounded-3xl shadow-2xl w-full max-w-sm relative transform transition-all">
            <button class="absolute top-4 right-4 text-text-muted hover:text-white text-2xl font-bold p-2 btn-close-modal">&times;</button>
            
            <div class="text-center mb-6">
                <div id="detail-icon" class="text-5xl mb-2">üç∫</div>
                <h3 id="detail-title" class="text-xl font-black text-gray-800 dark:text-white break-words"></h3>
                <p id="detail-date" class="text-xs text-text-muted font-bold mt-1"></p>
            </div>

            <div class="space-y-4 mb-8">
                <div class="flex justify-between items-center p-3 bg-base-50 dark:bg-base-700/50 rounded-xl">
                    <span class="text-xs font-bold text-text-muted">Balance</span>
                    <span id="detail-minutes" class="text-lg font-black text-gray-800 dark:text-white"></span>
                </div>
                
                <div id="detail-beer-info" class="hidden space-y-3">
                    <div class="grid grid-cols-2 gap-3">
                        <div class="p-3 bg-base-50 dark:bg-base-700/50 rounded-xl">
                            <p class="text-[10px] text-text-muted font-bold uppercase">STYLE</p>
                            <p id="detail-style" class="text-sm font-bold text-gray-800 dark:text-white truncate"></p>
                        </div>
                        <div class="p-3 bg-base-50 dark:bg-base-700/50 rounded-xl">
                            <p class="text-[10px] text-text-muted font-bold uppercase">SIZE</p>
                            <p id="detail-size" class="text-sm font-bold text-gray-800 dark:text-white truncate"></p>
                        </div>
                    </div>
                    <div class="p-3 bg-base-50 dark:bg-base-700/50 rounded-xl">
                        <p class="text-[10px] text-text-muted font-bold uppercase mb-1">BREWERY / BRAND</p>
                        <p id="detail-brand" class="text-sm font-bold text-gray-800 dark:text-white break-words"></p>
                    </div>
                </div>

                <div id="detail-memo-container" class="p-4 bg-accent/10 border border-accent/20 rounded-xl hidden">
                    <div id="detail-rating" class="text-accent text-sm mb-1"></div>
                    <p id="detail-memo" class="text-sm text-gray-700 dark:text-gray-300 italic"></p>
                </div>
            </div>

            <div class="flex gap-2">
                <button id="btn-detail-share" class="flex-1 bg-white dark:bg-white dark:text-black text-black font-bold py-3 rounded-xl hover:bg-gray-100 transition shadow-sm text-xs flex items-center justify-center gap-1">
                    <i class="ph-bold ph-share-network"></i> Share
                </button>
                <button id="btn-detail-copy" class="flex-1 bg-accent text-black font-bold py-3 rounded-xl hover:bg-accent-hover transition shadow-sm text-xs">Copy</button>
                <button id="btn-detail-edit" class="flex-1 bg-base-100 dark:bg-base-700 text-gray-700 dark:text-white font-bold py-3 rounded-xl hover:bg-base-200 transition shadow-sm text-xs">Edit</button>
                <button id="btn-detail-delete" class="flex-1 bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-400 font-bold py-3 rounded-xl hover:bg-red-100 transition shadow-sm text-xs">Delete</button>
            </div>
        </div>
    </div>

    <div id="manual-exercise-modal" class="fixed inset-0 bg-black/80 hidden z-[60] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="glass-panel bg-white dark:bg-base-800 p-6 rounded-3xl shadow-2xl w-full max-w-sm max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6 border-b border-base-200 dark:border-white/10 pb-4">
                <h3 class="text-lg font-bold text-gray-800 dark:text-white">üèÉ‚Äç‚ôÄÔ∏è Manual Input</h3>
                <button class="text-text-muted hover:text-white text-2xl font-bold p-2 btn-close-modal">&times;</button>
            </div>
            <p class="text-sm text-accent mb-2 font-bold" id="manual-exercise-name">Exercise Name</p>
            <div class="mb-4">
                <input type="date" id="manual-date" class="w-full p-3 bg-base-50 dark:bg-base-700 border border-base-200 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-recovery outline-none text-gray-800 dark:text-white font-bold text-center">
            </div>
            <div class="flex items-center mb-8">
                <input type="number" inputmode="decimal" id="manual-minutes" placeholder="30" class="w-full p-4 bg-base-50 dark:bg-base-700 border border-base-200 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-recovery outline-none text-gray-800 dark:text-white text-center font-bold text-3xl">
                <span class="ml-2 font-bold text-text-muted">min</span>
            </div>
            
            <div class="mb-4 flex items-center justify-center">
                <label class="inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="manual-apply-bonus" class="sr-only peer" checked>
                    <div class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-recovery"></div>
                    <span class="ms-3 text-xs font-medium text-gray-900 dark:text-gray-300">üî• Bonus Apply</span>
                </label>
            </div>

            <button id="btn-submit-manual" class="w-full bg-recovery hover:bg-recovery-hover text-white font-bold py-4 rounded-xl shadow-lg shadow-recovery/20 transition transform active:scale-95">Record</button>
        </div>
    </div>

    <div id="beer-modal" class="fixed inset-0 bg-black/80 hidden z-[60] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="glass-panel bg-white dark:bg-base-800 p-5 rounded-3xl shadow-2xl w-full max-w-sm max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4 border-b border-base-200 dark:border-white/10 pb-2">
                <h3 class="text-lg font-bold text-gray-800 dark:text-white">üç∫ Drink Log</h3>
                <button class="text-text-muted hover:text-white text-2xl font-bold p-2 btn-close-modal">&times;</button>
            </div>
            
            <div class="flex gap-2 mb-4 bg-base-100 dark:bg-base-700 p-1 rounded-xl">
                <button id="tab-beer-preset" class="flex-1 py-2 text-xs font-bold rounded-lg bg-white dark:bg-base-600 text-accent shadow-sm transition">Preset</button>
                <button id="tab-beer-custom" class="flex-1 py-2 text-xs font-bold rounded-lg text-text-muted hover:bg-white dark:hover:bg-base-600 transition">Custom</button>
            </div>

            <form id="beer-form">
                <div class="mb-4">
                    <label class="block text-[10px] font-bold text-text-muted mb-1.5 uppercase tracking-wide">DATE</label>
                    <input type="date" id="beer-date" class="w-full p-3 bg-base-50 dark:bg-base-900 border border-base-200 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-accent outline-none text-gray-800 dark:text-white font-bold">
                </div>

                <div id="beer-input-preset" class="space-y-4">
                    <div>
                        <div class="flex justify-between items-end mb-1.5">
                            <label class="block text-[10px] font-bold text-text-muted uppercase tracking-wide">Style</label>
                            <span class="text-[10px] text-accent font-bold bg-accent/10 px-2 py-0.5 rounded" id="beer-select-mode-label"></span>
                        </div>
                        <select id="beer-select" class="w-full p-3 bg-base-50 dark:bg-base-900 border border-base-200 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-accent outline-none text-gray-800 dark:text-white font-bold appearance-none"></select>
                    </div>

                    <div id="preset-abv-container">
                        <label class="block text-gray-700 dark:text-gray-300 text-xs font-bold mb-2">
                            ABV % <span class="text-[10px] font-normal text-text-muted">‚ÄªCalorie auto-calc</span>
                        </label>
                        <div class="relative">
                            <input type="number" id="preset-abv" step="0.1" placeholder="5.0" 
                                class="shadow-sm appearance-none border border-base-200 dark:border-white/10 dark:bg-base-900 dark:text-white rounded-xl w-full py-3 px-3 leading-tight focus:outline-none focus:ring-2 focus:ring-accent transition">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-[10px] font-bold text-text-muted mb-1.5 uppercase tracking-wide">Size</label>
                            <select id="beer-size" class="w-full p-3 bg-base-50 dark:bg-base-900 border border-base-200 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-accent outline-none text-gray-800 dark:text-white font-bold appearance-none"></select>
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-text-muted mb-1.5 uppercase tracking-wide">Count</label>
                            <input type="number" inputmode="decimal" id="beer-count" min="0.5" step="0.5" placeholder="1" class="w-full p-3 bg-base-50 dark:bg-base-900 border border-base-200 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-accent outline-none text-gray-800 dark:text-white text-center font-bold text-lg">
                        </div>
                    </div>
                </div>

                <div id="beer-input-custom" class="hidden space-y-4">
                    <div class="grid grid-cols-2 gap-3">
                         <label class="cursor-pointer group">
                           <input type="radio" name="customType" value="dry" class="peer hidden" checked>
                           <div class="p-3 rounded-xl border border-base-200 dark:border-white/10 bg-white dark:bg-base-900 peer-checked:border-orange-500 peer-checked:bg-orange-50 dark:peer-checked:bg-orange-900/30 peer-checked:text-orange-600 text-center transition group-hover:border-orange-200">
                             <div class="text-2xl mb-1">üî•</div>
                             <div class="text-[10px] font-bold">Spirits<br>(Zero Sugar)</div>
                           </div>
                         </label>
                         <label class="cursor-pointer group">
                           <input type="radio" name="customType" value="sweet" class="peer hidden">
                           <div class="p-3 rounded-xl border border-base-200 dark:border-white/10 bg-white dark:bg-base-900 peer-checked:border-yellow-500 peer-checked:bg-yellow-50 dark:peer-checked:bg-yellow-900/30 peer-checked:text-yellow-600 text-center transition group-hover:border-yellow-200">
                             <div class="text-2xl mb-1">üç∫</div>
                             <div class="text-[10px] font-bold">Brewed<br>(Has Sugar)</div>
                           </div>
                         </label>
                    </div>
                    <div class="flex gap-3">
                        <div class="flex-1">
                          <label class="block text-[10px] font-bold text-text-muted mb-1">ABV (%)</label>
                          <input type="number" id="custom-abv" inputmode="decimal" placeholder="5.0" step="0.1" class="w-full p-3 bg-base-50 dark:bg-base-900 border border-base-200 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-accent outline-none text-gray-800 dark:text-white font-bold text-center text-lg">
                        </div>
                        <div class="flex-1">
                          <label class="block text-[10px] font-bold text-text-muted mb-1">ml</label>
                          <input type="number" id="custom-amount" inputmode="decimal" placeholder="350" class="w-full p-3 bg-base-50 dark:bg-base-900 border border-base-200 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-accent outline-none text-gray-800 dark:text-white font-bold text-center text-lg">
                        </div>
                    </div>
                     <div class="flex gap-2 justify-center pb-2">
                         <button type="button" class="btn-quick-amount px-3 py-1 bg-base-100 dark:bg-base-700 rounded text-xs font-bold text-text-muted hover:text-white transition" data-amount="350">350ml</button>
                         <button type="button" class="btn-quick-amount px-3 py-1 bg-base-100 dark:bg-base-700 rounded text-xs font-bold text-text-muted hover:text-white transition" data-amount="500">500ml</button>
                    </div>
                </div>

                <div class="space-y-4 mt-6 border-t border-base-200 dark:border-white/10 pt-4">
                    <div class="bg-base-50 dark:bg-base-900 p-3 rounded-xl border border-base-100 dark:border-white/5 space-y-2">
                        <input type="text" id="beer-brewery" list="brewery-list" placeholder="Brewery (Optional)" class="w-full p-2.5 bg-white dark:bg-base-800 border border-base-200 dark:border-white/10 rounded-lg focus:ring-2 focus:ring-accent outline-none text-sm dark:text-white placeholder-gray-400">
                        <input type="text" id="beer-brand" list="brand-list" placeholder="Brand Name (Optional)" class="w-full p-2.5 bg-white dark:bg-base-800 border border-base-200 dark:border-white/10 rounded-lg focus:ring-2 focus:ring-accent outline-none text-sm dark:text-white placeholder-gray-400">
                    </div>

                    <div class="bg-accent/5 p-3 rounded-xl border border-accent/20 space-y-2">
                        <div class="flex items-center gap-2">
                            <label class="text-[10px] font-bold text-accent uppercase">Rating</label>
                            <select id="beer-rating" class="p-1 bg-white dark:bg-base-800 border border-accent/30 rounded text-sm font-bold text-accent outline-none">
                                <option value="0">None</option>
                                <option value="1">‚òÖ‚òÜ‚òÜ‚òÜ‚òÜ</option>
                                <option value="2">‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ</option>
                                <option value="3">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ</option>
                                <option value="4">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</option>
                                <option value="5">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</option>
                            </select>
                        </div>
                        <textarea id="beer-memo" rows="2" placeholder="Tasting notes..." class="w-full p-2.5 bg-white dark:bg-base-800 border border-accent/20 rounded-lg focus:ring-2 focus:ring-accent outline-none text-sm resize-none dark:text-white placeholder-gray-400"></textarea>
                    </div>
                    
                    <div class="flex items-center justify-center pt-1">
                        <label class="flex items-center space-x-2 cursor-pointer group">
                            <input type="checkbox" id="untappd-check" class="w-5 h-5 text-accent rounded border-gray-300 focus:ring-accent bg-base-50 dark:bg-base-700 dark:border-gray-600">
                            <span class="text-xs font-bold text-text-muted group-hover:text-accent transition">Search on Untappd</span>
                        </label>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-3 mt-4">
                    <button type="submit" id="beer-submit-btn" class="col-span-1 flex flex-col items-center justify-center leading-tight bg-accent hover:bg-accent-hover text-black font-bold py-4 rounded-xl shadow-lg shadow-accent/20 transition transform active:scale-95">
                        <span class="text-sm">Save & Close</span>
                    </button>
                    
                    <button type="button" id="btn-save-next" class="hidden col-span-1 bg-gray-600 hover:bg-gray-500 text-white font-bold py-4 rounded-xl shadow-lg transition transform active:scale-95 flex flex-col items-center justify-center leading-tight">
                        <span class="text-sm">Save & Next</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="check-modal" class="fixed inset-0 bg-black/80 hidden z-[60] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="glass-panel bg-white dark:bg-base-800 p-6 rounded-3xl shadow-2xl w-full max-w-sm max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-2">
                <h3 class="text-lg font-bold text-gray-800 dark:text-white">‚úÖ Daily Check</h3>
                <button class="text-text-muted hover:text-white text-2xl font-bold p-2 btn-close-modal">&times;</button>
            </div>
            <p class="text-xs text-text-muted mb-6 font-medium">Reflect on your condition.</p>
            <form id="check-form">
                <div class="space-y-4 mb-8">
                    <div class="p-2 bg-base-50 dark:bg-base-700/50 border border-base-200 dark:border-white/10 rounded-lg">
                        <label class="block text-[10px] font-bold text-text-muted mb-1 ml-1 uppercase">DATE</label>
                        <input type="date" id="check-date" class="w-full p-2 bg-transparent border-none outline-none text-gray-700 dark:text-white font-bold">
                    </div>
                    
                    <div class="flex items-center justify-between p-3.5 bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 rounded-xl">
                        <span class="text-blue-800 dark:text-blue-300 font-bold text-sm">üçµ Dry Day (No Alcohol)</span>
                        <input type="checkbox" id="is-dry-day" class="h-6 w-6 text-blue-600 rounded focus:ring-blue-500 border-gray-300 bg-white dark:bg-base-700 dark:border-gray-600">
                    </div>
                    <div id="drinking-section" class="bg-indigo-50 dark:bg-indigo-900/20 p-4 rounded-xl border border-indigo-100 dark:border-indigo-800">
                        <h4 class="text-[10px] font-bold text-indigo-500 dark:text-indigo-400 uppercase tracking-wider mb-3">üõ°Ô∏è Countermeasures</h4>
                        <div class="space-y-3">
                            <label class="flex items-center justify-between bg-white dark:bg-base-800 p-3 rounded-lg border border-indigo-100 dark:border-base-700 hover:border-indigo-300 cursor-pointer"><span class="text-gray-700 dark:text-gray-300 font-bold text-sm">ü•ó Fiber Before Drink</span><input type="checkbox" name="fiberOk" class="h-5 w-5 text-indigo-600 rounded bg-base-100 dark:bg-base-700"></label>
                            <label class="flex items-center justify-between bg-white dark:bg-base-800 p-3 rounded-lg border border-indigo-100 dark:border-base-700 hover:border-indigo-300 cursor-pointer"><span class="text-gray-700 dark:text-gray-300 font-bold text-sm">üíß Water Intake</span><input type="checkbox" name="waterOk" class="h-5 w-5 text-indigo-600 rounded bg-base-100 dark:bg-base-700"></label>
                        </div>
                    </div>
                    <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-xl border border-green-100 dark:border-green-800">
                        <h4 class="text-[10px] font-bold text-green-600 dark:text-green-400 uppercase tracking-wider mb-3">üßò Condition</h4>
                        <div class="space-y-3">
                            <label class="flex items-center justify-between bg-white dark:bg-base-800 p-3 rounded-lg border border-green-100 dark:border-base-700 hover:border-green-300 cursor-pointer"><span class="text-gray-700 dark:text-gray-300 font-bold text-sm">üëñ Waist Ease</span><input type="checkbox" name="waistEase" class="h-5 w-5 text-green-600 rounded bg-base-100 dark:bg-base-700"></label>
                            <label class="flex items-center justify-between bg-white dark:bg-base-800 p-3 rounded-lg border border-green-100 dark:border-base-700 hover:border-green-300 cursor-pointer"><span class="text-gray-700 dark:text-gray-300 font-bold text-sm">ü¶∂ No Swelling</span><input type="checkbox" name="footLightness" class="h-5 w-5 text-green-600 rounded bg-base-100 dark:bg-base-700"></label>
                        </div>
                    </div>
                    <div class="pt-4 border-t border-base-200 dark:border-white/10">
                         <label class="block text-[10px] font-bold text-text-muted mb-1">üìè Weight (Optional)</label>
                         <div class="flex items-center gap-2">
                             <input type="number" inputmode="decimal" id="check-weight" step="0.1" class="w-full p-3 bg-base-50 dark:bg-base-700 border border-base-200 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none text-center font-bold text-gray-700 dark:text-white">
                             <span class="text-xs font-bold text-text-muted">kg</span>
                         </div>
                    </div>
                </div>
                <button type="submit" id="check-submit-btn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-4 rounded-xl shadow-lg transition transform active:scale-95">Complete</button>
            </form>
        </div>
    </div>    

    <div id="settings-modal" class="fixed inset-0 bg-black/80 hidden z-[60] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="glass-panel bg-white dark:bg-base-800 p-0 rounded-3xl shadow-2xl w-full max-w-sm max-h-[90vh] flex flex-col overflow-hidden">
            <div class="flex justify-between items-center p-5 border-b border-base-200 dark:border-white/10 bg-base-50 dark:bg-base-800/50">
                <h3 class="text-lg font-black text-gray-800 dark:text-white flex items-center gap-2">
                    <span>‚öôÔ∏è</span> Settings
                </h3>
                <button class="text-text-muted hover:text-white text-2xl font-bold p-2 btn-close-modal">&times;</button>
            </div>

            <div class="p-6 overflow-y-auto custom-scrollbar space-y-8">
                
                <section>
                    <h4 class="text-[10px] font-bold text-indigo-500 dark:text-indigo-400 mb-3 uppercase tracking-widest border-b border-indigo-100 dark:border-white/10 pb-1">
                        1. Body Data
                    </h4>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-[10px] text-text-muted mb-1 font-bold">Height (cm)</label>
                            <input type="number" inputmode="decimal" id="height-input" min="100" max="250" class="w-full p-3 bg-base-50 dark:bg-base-900 border border-base-200 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none text-center font-bold text-gray-800 dark:text-white text-lg">
                        </div>
                        <div>
                            <label class="block text-[10px] text-text-muted mb-1 font-bold">Weight (kg)</label>
                            <input type="number" inputmode="decimal" id="weight-input" min="20" max="200" step="0.1" class="w-full p-3 bg-base-50 dark:bg-base-900 border border-base-200 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none text-center font-bold text-gray-800 dark:text-white text-lg">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-[10px] text-text-muted mb-1 font-bold">Age</label>
                            <input type="number" inputmode="decimal" id="age-input" min="10" max="100" class="w-full p-3 bg-base-50 dark:bg-base-900 border border-base-200 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none text-center font-bold text-gray-800 dark:text-white">
                        </div>
                        <div>
                            <label class="block text-[10px] text-text-muted mb-1 font-bold">Gender</label>
                            <select id="gender-input" class="w-full p-3 bg-base-50 dark:bg-base-900 border border-base-200 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none text-center font-bold text-gray-800 dark:text-white">
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                            </select>
                        </div>
                    </div>
                </section>

                <section>
                    <h4 class="text-[10px] font-bold text-accent mb-3 uppercase tracking-widest border-b border-accent/20 pb-1">
                        2. Payback Rules
                    </h4>
                    
                    <div class="mb-4">
                        <label class="block text-[10px] font-bold text-text-muted mb-2">
                            Base Exercise
                        </label>
                        <div class="bg-accent/10 p-2 rounded-xl border border-accent/20">
                            <select id="setting-base-exercise" class="w-full p-3 bg-white dark:bg-base-800 border border-accent/20 rounded-lg text-sm font-bold text-gray-800 dark:text-white outline-none focus:ring-2 focus:ring-accent"></select>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <div>
                            <label class="block text-[10px] font-bold text-text-muted mb-1">Mode 1 (Main)</label>
                            <div class="bg-base-50 dark:bg-base-900 p-1.5 rounded-lg border border-base-200 dark:border-white/10">
                                <select id="setting-mode-1" class="w-full p-2 bg-white dark:bg-base-800 border border-base-200 dark:border-white/10 rounded-md text-xs font-bold text-gray-800 dark:text-white"></select>
                            </div>
                        </div>
                        <div>
                            <label class="block text-[10px] font-bold text-text-muted mb-1">Mode 2 (Sub)</label>
                            <div class="bg-base-50 dark:bg-base-900 p-1.5 rounded-lg border border-base-200 dark:border-white/10">
                                <select id="setting-mode-2" class="w-full p-2 bg-white dark:bg-base-800 border border-base-200 dark:border-white/10 rounded-md text-xs font-bold text-gray-800 dark:text-white"></select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-base-50 dark:bg-base-900 p-3 rounded-xl border border-base-200 dark:border-white/10">
                        <label class="block text-[10px] text-text-muted mb-1 font-bold">Default Record Exercise</label>
                        <select id="setting-default-record-exercise" class="w-full p-2 bg-white dark:bg-base-800 border border-base-200 dark:border-white/10 rounded-lg text-sm font-bold text-gray-800 dark:text-white outline-none focus:ring-2 focus:ring-indigo-500"></select>
                    </div>
                </section>

                <section>
                    <h4 class="text-[10px] font-bold text-text-muted mb-3 uppercase tracking-widest border-b border-base-200 dark:border-white/10 pb-1">
                        3. System
                    </h4>
                    <div>
                        <label class="block text-[10px] font-bold text-text-muted mb-1">Theme</label>
                        <select id="theme-input" class="w-full p-3 bg-base-50 dark:bg-base-900 border border-base-200 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none text-center font-bold text-gray-800 dark:text-white">
                            <option value="system">üì± System</option>
                            <option value="light">‚òÄÔ∏è Light</option>
                            <option value="dark">üåô Dark</option>
                        </select>
                    </div>
                </section>

            </div>

            <div class="p-4 border-t border-base-200 dark:border-white/10 bg-base-50 dark:bg-base-800">
                <button id="btn-save-settings" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-indigo-200 dark:shadow-none transition transform active:scale-95 text-sm">Save & Start</button>
            </div>
        </div>
    </div>
    
        <div id="help-modal" class="fixed inset-0 bg-gray-900 bg-opacity-60 hidden z-[70] flex items-center justify-center p-4 backdrop-blur-sm modal-bg">
        <div class="bg-white dark:bg-gray-800 rounded-3xl shadow-2xl w-full max-w-lg max-h-[85vh] flex flex-col modal-content transition-colors overflow-hidden">
            <div class="flex justify-between items-center p-5 border-b border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50">
                <h3 class="text-lg font-black text-gray-800 dark:text-white flex items-center gap-2">
                    <span class="text-2xl">üìñ</span> ‰Ωø„ÅÑÊñπ„Ç¨„Ç§„Éâ
                </h3>
                <button class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 text-2xl font-bold p-4 btn-close-modal transition-transform hover:rotate-90">&times;</button>
            </div>
            
            <div class="p-6 overflow-y-auto space-y-8 custom-scrollbar">
                
                <section class="text-center">
                    <h4 class="text-sm font-bold text-indigo-600 dark:text-indigo-400 mb-3 tracking-widest uppercase">CONCEPT</h4>
                    <p class="text-lg font-bold text-gray-800 dark:text-white mb-2">
                        „ÄåÈ£≤„Çì„Å†„Çâ„ÄÅÂãï„ÅÑ„Å¶Ëøî„Åô„Äç
                    </p>
                    <p class="text-xs text-gray-500 dark:text-gray-400 leading-relaxed">
                        È£≤ÈÖí„ÅØ<span class="font-bold text-red-500">„ÄåÂÄüÈáë„Äç</span>„ÄÅÈÅãÂãï„ÅØ<span class="font-bold text-green-500">„ÄåËøîÊ∏à„Äç</span>„ÄÇ<br>
                        È£≤„Çì„Å†„Éì„Éº„É´„ÅÆ„Ç´„É≠„É™„ÉºÂàÜ„Çí„ÄÅÈÅãÂãï„ÅßÊ∂àË≤ª„Åó„Å¶<br>
                        <span class="font-bold">„ÄåÂÆüË≥™„Çº„É≠„Ç´„É≠„É™„Éº„Äç</span>„ÇíÁõÆÊåá„Åô„Ç≤„Éº„É†„Åß„Åô„ÄÇ
                    </p>
                </section>
                
                <section>
                    <h4 class="text-sm font-bold text-indigo-600 dark:text-indigo-400 mb-4 tracking-widest uppercase text-center">HOW TO PLAY</h4>
                    <div class="space-y-3">
                        <div class="flex items-start gap-4 p-3 rounded-2xl bg-gray-50 dark:bg-gray-700/50 border border-gray-100 dark:border-gray-700">
                            <div class="bg-white dark:bg-gray-600 w-10 h-10 rounded-full flex items-center justify-center text-xl shadow-sm flex-shrink-0">‚öôÔ∏è</div>
                            <div>
                                <h5 class="font-bold text-gray-800 dark:text-white text-sm">STEP 1. „Åæ„Åö„ÅØË®≠ÂÆö</h5>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Âè≥‰∏ä„ÅÆÊ≠ØËªä„Éú„Çø„É≥„Åã„Çâ„Éó„É≠„Éï„Ç£„Éº„É´ÔºàË∫´Èï∑„Éª‰ΩìÈáçÔºâ„ÇíÂÖ•Âäõ„ÄÇ„Åì„Çå„ÅåÊ≠£Á¢∫„Å™„Ç´„É≠„É™„ÉºÂÄüÈáëË®àÁÆó„ÅÆÈçµ„Åß„ÅôÔºÅ</p>
                            </div>
                        </div>

                        <div class="flex items-start gap-4 p-3 rounded-2xl bg-orange-50 dark:bg-orange-900/10 border border-orange-100 dark:border-orange-900/30">
                            <div class="bg-white dark:bg-gray-600 w-10 h-10 rounded-full flex items-center justify-center text-xl shadow-sm flex-shrink-0">üç∫</div>
                            <div>
                                <h5 class="font-bold text-orange-700 dark:text-orange-400 text-sm">STEP 2. È£≤„Çì„Å†„ÇâË®òÈå≤ÔºàÂÄüÈáëÔºâ</h5>
                                <p class="text-xs text-orange-600/80 dark:text-orange-300/80 mt-1">„ÄåË®òÈå≤„Äç„Çø„Éñ„Åß„ÅäÈÖí„ÇíÂÖ•Âäõ„ÄÇ„Éõ„Éº„É†ÁîªÈù¢„ÅÆ„Ç∞„É©„Çπ„ÅåÁ©∫„Å£„ÅΩ„Å´„Å™„Çä„ÄÅÂÄüÈáëÊôÇÈñìÔºàÈÅãÂãï„Éé„É´„ÉûÔºâ„ÅåÂ¢ó„Åà„Åæ„Åô„ÄÇ</p>
                            </div>
                        </div>

                        <div class="flex items-start gap-4 p-3 rounded-2xl bg-green-50 dark:bg-green-900/10 border border-green-100 dark:border-green-900/30">
                            <div class="bg-white dark:bg-gray-600 w-10 h-10 rounded-full flex items-center justify-center text-xl shadow-sm flex-shrink-0">üèÉ‚Äç‚ôÄÔ∏è</div>
                            <div>
                                <h5 class="font-bold text-green-700 dark:text-green-400 text-sm">STEP 3. Âãï„ÅÑ„Å¶ËøîÊ∏à</h5>
                                <p class="text-xs text-green-600/80 dark:text-green-300/80 mt-1">„Çπ„ÉÜ„ÉÉ„Éë„Éº„ÇÑ„Ç¶„Ç©„Éº„Ç≠„É≥„Ç∞„ÅßÈÅãÂãï„ÄÇ„ÄåSTART„Äç„Éú„Çø„É≥„ÅßË®àÊ∏¨„Åô„Çã„Åã„ÄÅÊâãÂÖ•Âäõ„ÅßË®òÈå≤„Åó„Å¶ÂÄüÈáë„ÇíÂÆåÊ∏à„Åó„Åæ„Åó„Çá„ÅÜÔºÅ</p>
                            </div>
                        </div>
                    </div>
                </section>
                
                <section>
                    <h4 class="text-sm font-bold text-indigo-600 dark:text-indigo-400 mb-3 tracking-widest uppercase text-center">RANK SYSTEM</h4>
                    <div class="bg-indigo-50 dark:bg-indigo-900/20 p-4 rounded-2xl border border-indigo-100 dark:border-indigo-800 text-center">
                        <p class="text-xs text-gray-600 dark:text-gray-300 mb-3">
                            Áõ¥Ëøë28Êó•Èñì„ÅÆ<span class="font-bold text-indigo-600 dark:text-indigo-400">„Äå‰ºëËÇùÊó•Áéá„Äç</span>„Åß„É©„É≥„ÇØ„ÅåÊ±∫„Åæ„Çä„Åæ„Åô„ÄÇ<br>
                            ‰ºëËÇùÊó•„Çí‰Ωú„Å£„Å¶„É©„É≥„ÇØ„Ç¢„ÉÉ„Éó„ÇíÁõÆÊåá„Åù„ÅÜÔºÅ
                        </p>
                        
                        <div class="mb-4 bg-white dark:bg-gray-800 p-2 rounded-lg border border-indigo-100 dark:border-indigo-700">
                            <span class="text-xs font-bold bg-orange-500 text-white px-2 py-0.5 rounded-full">üî∞ „É´„Éº„Ç≠„Éº„É¢„Éº„Éâ</span>
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                ÈñãÂßã28Êó•Èñì„ÅØ„ÄåÊó•Êï∞„Äç„Åß„ÅØ„Å™„Åè„ÄåÊàêÂäüÁéá„Äç„ÅßÂà§ÂÆö„ÄÇ<br>ÂàùÂøÉËÄÖ„Åß„ÇÇ„Åô„Åê„Å´S„É©„É≥„ÇØ„ÇíÁõÆÊåá„Åõ„Åæ„ÅôÔºÅ
                            </p>
                        </div>

                        <div class="grid grid-cols-2 gap-2">
                            <div class="bg-white dark:bg-gray-800 p-2 rounded-lg border border-purple-100 dark:border-purple-900/50 shadow-sm">
                                <span class="block text-xl mb-1">üëº</span>
                                <span class="block text-xs font-bold text-purple-600 dark:text-purple-400">„É©„É≥„ÇØ S</span>
                                <span class="block text-xs text-gray-400">ÈÄ±5Êó• ‰ºëËÇù</span>
                            </div>
                            <div class="bg-white dark:bg-gray-800 p-2 rounded-lg border border-indigo-100 dark:border-indigo-900/50 shadow-sm">
                                <span class="block text-xl mb-1">üõ°Ô∏è</span>
                                <span class="block text-xs font-bold text-indigo-600 dark:text-indigo-400">„É©„É≥„ÇØ A</span>
                                <span class="block text-xs text-gray-400">ÈÄ±3Êó• ‰ºëËÇù</span>
                            </div>
                            <div class="bg-white dark:bg-gray-800 p-2 rounded-lg border border-green-100 dark:border-green-900/50 shadow-sm">
                                <span class="block text-xl mb-1">üåø</span>
                                <span class="block text-xs font-bold text-green-600 dark:text-green-400">„É©„É≥„ÇØ B</span>
                                <span class="block text-xs text-gray-400">ÈÄ±2Êó• ‰ºëËÇù</span>
                            </div>
                            <div class="bg-white dark:bg-gray-800 p-2 rounded-lg border border-gray-100 dark:border-gray-700 shadow-sm">
                                <span class="block text-xl mb-1">‚ö†Ô∏è</span>
                                <span class="block text-xs font-bold text-gray-500 dark:text-gray-400">„É©„É≥„ÇØ C</span>
                                <span class="block text-xs text-gray-400">„Åå„Çì„Å∞„Çç„ÅÜ</span>
                            </div>
                        </div>
                    </div>
                </section>

                <section>
                    <h4 class="text-sm font-bold text-indigo-600 dark:text-indigo-400 mb-3 tracking-widest uppercase text-center">USEFUL TIPS</h4>
                    <ul class="grid grid-cols-1 gap-2 text-xs text-gray-600 dark:text-gray-300">
                        <li class="flex items-center gap-3 bg-gray-50 dark:bg-gray-700/50 p-2.5 rounded-lg">
                            <span class="text-lg">üëÜ</span>
                            <span><strong>„Çπ„ÉØ„Ç§„ÉóÊìç‰Ωú:</strong> ÁîªÈù¢„ÇíÂ∑¶Âè≥„Å´„Çπ„ÉØ„Ç§„Éó„Åô„Çã„Å®„ÄÅ„Çø„ÉñÔºà„Éõ„Éº„É†‚áîË®òÈå≤‚áîÂ±•Ê≠¥Ôºâ„Çí„Çµ„ÇØ„Çµ„ÇØÂàá„ÇäÊõø„Åà„Çâ„Çå„Åæ„Åô„ÄÇ</span>
                        </li>
                        <li class="flex items-center gap-3 bg-gray-50 dark:bg-gray-700/50 p-2.5 rounded-lg">
                            <span class="text-lg">‚ö°</span>
                            <span><strong>„ÅÑ„Å§„ÇÇ„ÅÆ„Éú„Çø„É≥:</strong> „Çà„ÅèÈ£≤„ÇÄ„ÅäÈÖí„ÅØ„ÄÅË®òÈå≤ÁîªÈù¢„ÅÆ‰∏äÈÉ®„Å´„Äå„ÅÑ„Å§„ÇÇ„ÅÆ„Äç„Å®„Åó„Å¶Ëá™ÂãïÁôªÈå≤„Åï„Çå„Åæ„Åô„ÄÇ</span>
                        </li>
                        <li class="flex items-center gap-3 bg-gray-50 dark:bg-gray-700/50 p-2.5 rounded-lg">
                            <span class="text-lg">üî•</span>
                            <span><strong>ÈÄ£Á∂öË®òÈå≤„Éú„Éº„Éä„Çπ:</strong> ‰ºëËÇùÊó•„ÇíÁ∂ö„Åë„Çã„Å®„ÄÅÈÅãÂãïÊôÇ„ÅÆ„ÄåËøîÊ∏àÂäπÁéá„Äç„Åå„Ç¢„ÉÉ„ÉóÔºÅ(ÊúÄÂ§ß1.2ÂÄç)</span>
                        </li>
                        <li class="flex items-center gap-3 bg-gray-50 dark:bg-gray-700/50 p-2.5 rounded-lg">
                            <span class="text-lg">‚úÖ</span>
                            <span><strong>„Éá„Ç§„É™„Éº„ÉÅ„Çß„ÉÉ„ÇØ:</strong> È£≤„Çì„Å†ÁøåÊó•„ÇÑ‰ºëËÇùÊó•„Å´„ÅØ„ÄåÂÅ•Â∫∑„ÉÅ„Çß„ÉÉ„ÇØ„Äç„Çí„ÄÇ‰ΩìË™ø„ÅÆÂ§âÂåñ„Çí„Ç∞„É©„Éï„ÅßÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô„ÄÇ</span>
                        </li>
                    </ul>
                </section>

                <section>
                    <h4 class="text-sm font-bold text-indigo-600 dark:text-indigo-400 mb-3 tracking-widest uppercase text-center">OTHER DRINKS</h4>
                    <p class="text-xs text-center text-gray-500 dark:text-gray-400 mb-3">„Éì„Éº„É´‰ª•Â§ñ„ÇíÈ£≤„ÇÄ„Å®„Åç„ÅØ„ÄÅ„Ç´„É≠„É™„Éº„ÇÑÂ∫¶Êï∞„ÅåËøë„ÅÑ‰ª•‰∏ã„ÅÆ„Çπ„Çø„Ç§„É´„ÇíÈÅ∏„Çì„ÅßË®òÈå≤„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                    
                    <div class="overflow-hidden rounded-xl border border-gray-200 dark:border-gray-700">
                        <table class="w-full text-left border-collapse text-xs">
                            <thead class="bg-gray-100 dark:bg-gray-800 text-gray-500 dark:text-gray-400">
                                <tr>
                                    <th class="p-3 font-bold">È£≤„ÅøÁâ©</th>
                                    <th class="p-3 font-bold">„Åä„Åô„Åô„ÇÅË®≠ÂÆö</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100 dark:divide-gray-700 bg-white dark:bg-gray-700/30 text-gray-700 dark:text-gray-200">
                                <tr>
                                    <td class="p-3">üç∑ „ÉØ„Ç§„É≥ / Êó•Êú¨ÈÖí</td>
                                    <td class="p-3"><span class="font-bold">„Éô„É´„Ç∏„É£„É≥„Éª„Éà„É™„Éö„É´</span> (250ml)</td>
                                </tr>
                                <tr>
                                    <td class="p-3">ü•É „Éè„Ç§„Éú„Éº„É´ (7%)</td>
                                    <td class="p-3"><span class="font-bold">„Ç¢„É≥„Éê„Éº„Ç®„Éº„É´</span></td>
                                </tr>
                                <tr>
                                    <td class="p-3">üçã „É¨„É¢„É≥„Çµ„ÉØ„Éº</td>
                                    <td class="p-3"><span class="font-bold">„Éö„Éº„É´„Ç®„Éº„É´</span></td>
                                </tr>
                                <tr>
                                    <td class="p-3">ü•§ „Çπ„Éà„É≠„É≥„Ç∞Á≥ª (9%)</td>
                                    <td class="p-3"><span class="font-bold">IPA (West Coast)</span></td>
                                </tr>
                                <tr>
                                    <td class="p-3">üçµ ÁÑºÈÖé„Éè„Ç§/„ÅäËå∂Ââ≤</td>
                                    <td class="p-3"><span class="font-bold">„Çª„ÉÉ„Ç∑„Éß„É≥IPA</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

            </div>
            
            <div class="p-4 border-t border-base-200 dark:border-white/10 bg-base-50 dark:bg-base-800">
                <button class="w-full bg-base-800 dark:bg-base-700 text-white font-bold py-3.5 rounded-xl shadow-md text-sm btn-close-modal hover:bg-base-900 transition active:scale-95">Close</button>
            </div>
        </div>
    </div>

    <div id="swipe-coach-mark" class="fixed inset-0 z-[80] bg-black/60 hidden flex-col items-center justify-center pointer-events-none transition-opacity duration-500 opacity-0">
        <div class="relative w-64 h-64 flex items-center justify-center">
            <div class="text-6xl animate-bounce-horizontal filter drop-shadow-lg">üëÜ</div>
            <div class="absolute bottom-10 w-full text-center">
                <p class="text-white font-bold text-lg drop-shadow-md">Swipe to Switch Tabs</p>
            </div>
        </div>
    </div>
    
    <datalist id="brewery-list"></datalist>
    <datalist id="brand-list"></datalist>
    <script type="module" src="./main.js"></script>
    <script type="module" src="./test.js"></script>
</body>
</html>